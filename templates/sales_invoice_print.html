<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Invoice</title>
    <style>
      :root {
        --accent: #2b5a85;
        --line: #d8dee6;
        --soft: #eef3f8;
      }
      * { box-sizing: border-box; }
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        color: #1f2937;
        background: #fff;
      }
      .page {
        max-width: 980px;
        margin: 32px auto 48px;
        padding: 0 24px;
      }
      .print-controls { display:flex; justify-content:center; margin-bottom:24px; }
      .btn { border:1px solid #16a34a; color:#16a34a; padding:8px 20px; border-radius:6px; background:#fff; cursor:pointer; font-size:14px; }
      .header { display:flex; justify-content:space-between; gap:20px; margin-bottom:18px; }
      .company { font-size:14px; line-height:1.4; }
      .company-name { font-weight:600; font-size:16px; margin-bottom:6px; }
      .invoice-meta { text-align:right; font-size:13px; }
      .invoice-meta .row { display:flex; gap:10px; justify-content:flex-end; }
      .invoice-meta .label { color:#6b7280; width:90px; text-align:right; }
      .title { color:#3b82f6; font-size:20px; font-weight:600; margin:12px 0 8px; }
      .bill-to { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:18px; }
      .divider { border-top:2px solid var(--line); margin:16px 0; }
      table { width:100%; border-collapse:collapse; font-size:13px; }
      thead th { text-align:left; background:var(--soft); color:var(--accent); font-weight:600; padding:8px 10px; border-bottom:1px solid var(--line); }
      thead th.num { text-align:right; }
      tbody td { padding:10px; border-bottom:1px solid #e5e7eb; }
      tbody td.num { text-align:right; white-space:nowrap; }
      .totals { display:flex; justify-content:flex-end; margin-top:14px; }
      .totals table { width:320px; border-collapse:separate; border-spacing:0 6px; }
      .totals td { padding:2px 0; }
      .totals td.label { color:#6b7280; text-align:left; }
      .totals td.value { text-align:right; font-weight:600; }
      .balance { border-top:1px dashed var(--line); padding-top:8px; margin-top:6px; }
      @media print { .print-controls { display:none; } .page { margin:0; padding:0 24px; } }
    </style>
  </head>
  <body>
    <div class="page">
      <div class="print-controls">
        <button class="btn" onclick="window.print()">Print</button>
      </div>

      <div class="header">
        <div class="company">
          <div class="company-name">{{ invoice.company.name if invoice.company else '' }}</div>
          {% if invoice.company and invoice.company.address %}
            {% set company_lines = invoice.company.address.split('\n') if '\n' in invoice.company.address else invoice.company.address.split(',') %}
            {% for line in company_lines %}
              {% if line.strip() %}
                <div>{{ line.strip() }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if invoice.company and invoice.company.business_number %}
            <div>HST Number # {{ invoice.company.business_number }} RT0001</div>
          {% endif %}
        </div>
        <div class="invoice-meta">
          <div class="row"><div class="label">Invoice</div><div>{{ invoice.id }}</div></div>
          <div class="row"><div class="label">Date</div><div>{{ invoice.invoice_date.strftime('%d/%m/%Y') if invoice.invoice_date else '' }}</div></div>
          <div class="row"><div class="label">Terms</div><div>{{ invoice.terms or '' }}</div></div>
          <div class="row"><div class="label">Due Date</div><div>{{ invoice.due_date.strftime('%d/%m/%Y') if invoice.due_date else '' }}</div></div>
        </div>
      </div>

      <div class="title">INVOICE</div>

      <div class="bill-to">
        <div>
          <div style="font-size:12px; color:#6b7280;">BILL TO</div>
          <div style="font-weight:600; margin-top:4px;">{{ invoice.customer.name if invoice.customer else '' }}</div>
          {% if invoice.customer and invoice.customer.company_name %}
            <div style="font-size:12px; color:#6b7280;">{{ invoice.customer.company_name }}</div>
          {% endif %}
          {% if invoice.customer and invoice.customer.address %}
            {% set cust_lines = invoice.customer.address.split('\n') if '\n' in invoice.customer.address else invoice.customer.address.split(',') %}
            {% for line in cust_lines %}
              {% if line.strip() %}
                <div style="font-size:12px; color:#6b7280;">{{ line.strip() }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if invoice.customer and invoice.customer.tax_number %}
            <div style="font-size:12px; color:#6b7280;">HST Number # {{ invoice.customer.tax_number }} RT 0001</div>
          {% endif %}
        </div>
      </div>

      <div class="divider"></div>

      <table>
        <thead>
          <tr>
            <th>SERVICE</th>
            <th>DESCRIPTION</th>
            <th class="num">TAX</th>
            <th class="num">QTY</th>
            <th class="num">RATE</th>
            <th class="num">AMOUNT</th>
          </tr>
        </thead>
        <tbody>
          {% for line in invoice.lines %}
            <tr>
              <td>{{ line.service or '' }}</td>
              <td>{{ line.description or '' }}</td>
              <td class="num">{{ 'HST ON' if line.taxable else 'Exempt' }}</td>
              <td class="num">{{ '%.2f'|format(line.qty or 0) }}</td>
              <td class="num">{{ line.rate | money }}</td>
              <td class="num">{{ line.amount | money }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="totals">
        <table>
          <tr>
            <td class="label">SUBTOTAL</td>
            <td class="value">{{ invoice.subtotal | money }}</td>
          </tr>
          <tr>
            <td class="label">HST (ON) @ 13%</td>
            <td class="value">{{ invoice.tax_total | money }}</td>
          </tr>
          <tr>
            <td class="label">TOTAL</td>
            <td class="value">{{ invoice.total | money }}</td>
          </tr>
          <tr class="balance">
            <td class="label">BALANCE DUE</td>
            <td class="value">{{ invoice.balance_due | money }}</td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
