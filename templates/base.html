<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Payroll App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .card-accent { border: none; box-shadow: 0 1px 3px rgba(16,24,40,0.04); border-left: 4px solid #0d6efd; }
      .card-accent .card-body { padding: .75rem 1rem; }
      .card-accent:hover { box-shadow: 0 4px 12px rgba(13,110,253,0.08); }
      .accent-link { color: #0d6efd; font-weight: 600; }
      .nav-card {
        display: flex;
        align-items: center;
        background: #C3C3C3;
        border-radius: 6px;
        margin-bottom: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        border-left: 4px solid #B0151A;
        padding: .5rem .85rem;
        transition: box-shadow 0.2s;
      }
      .nav-card:hover {
        box-shadow: 0 4px 16px rgba(176,21,26,0.08);
        background: #e0e0e0;
      }
      .nav-card a {
        text-decoration: none;
        color: #000;
        font-weight: 600;
        font-size: 1rem;
        letter-spacing: 0.5px;
      }
    </style>
  </head>
  <body style="min-height:100vh; display:flex; flex-direction:column;">
    {% set hide_header = hide_header|default(false) %}
    {% if not hide_header %}
    <header class="py-3 mb-1 border-bottom" style="background:#C3C3C3;">
      <div class="container d-flex align-items-center">
        <img src="{{ url_for('static', filename='logos/cropped-PB-tax-Logo-1.png') }}" alt="PB Tax Solutions Inc." style="height:84px; margin-right:20px; object-fit:contain; filter:brightness(0) saturate(100%) invert(13%) sepia(99%) saturate(7499%) hue-rotate(349deg) brightness(90%) contrast(110%);">
        <div>
          <h2 class="mb-1" style="color:#B0151A;">PB Tax Solutions Inc.</h2>
          <div class="d-flex align-items-baseline gap-3">
            <span class="h5 mb-0" style="color:#B0151A; font-weight:600;">Payroll Made Simple.</span>
            <span style="color:#B0151A; font-size:1.25rem; font-weight:600;">|</span>
            <span class="h5 mb-0" style="color:#B0151A; font-weight:600;">Accuracy Guaranteed</span>
          </div>
        </div>

        <div class="ms-auto d-flex align-items-center gap-2">
          {% if header_company_name or header_company_number %}
            <div class="text-end me-2" style="line-height:1.1;">
              {% if header_company_name %}
                <div style="font-weight:600; color:#B0151A;">{{ header_company_name }}</div>
              {% endif %}
              {% if header_company_number %}
                <div style="font-size:0.9rem; color:#B0151A;">{{ header_company_number }}</div>
              {% endif %}
            </div>
          {% endif %}
          {% if session.get('role') == 'admin' %}
            <span class="badge" style="background:#B0151A; color:#fff; font-weight:600;">Admin</span>
          {% endif %}
          {% if session.get('user_id') %}
            <a href="/change-password" class="btn btn-sm" style="border:1px solid #B0151A; color:#B0151A; font-weight:600;">Change Password</a>
            <a href="/logout" class="btn btn-sm" style="border:1px solid #B0151A; color:#B0151A; font-weight:600;">Logout</a>
          {% endif %}
        </div>
      </div>
    </header>
    {% endif %}

    <div class="container mt-1 mb-3">
      {% set role = session.get('role') %}
      {% set path = request.path %}
      {% set is_expenses = path.startswith('/subcontracts') or path.startswith('/expenses') %}
      {% set is_payroll = path.startswith('/payroll') or path.startswith('/data-entry') or path.startswith('/employees') or path.startswith('/companies') or path.startswith('/reports') or path.startswith('/manage/companies') or path.startswith('/manage/employees') or path.startswith('/manage/data') or path.startswith('/admin/submissions') or path.startswith('/owner/payroll') %}
      {% set hide_sidebar = hide_sidebar|default(false) %}
      {% set hide_nav = hide_nav|default(false) %}
      {% set show_hamburger = show_hamburger|default(false) %}
      {% set expenses_menu_mode = expenses_menu_mode|default('expenses') %}
      {% if not hide_nav %}
        <div class="d-flex gap-2 justify-content-center flex-wrap">
          <div class="nav-card"><a href="/">Home</a></div>
          <div class="nav-card"><a href="/payroll">Run Payroll</a></div>
          <div class="nav-card"><a href="/expenses">Expenses &amp; Bills</a></div>
        </div>
      {% endif %}
    </div>

    <div class="container" style="flex:1 0 auto; max-width: 1100px;">
      <div class="row">
        {% if show_hamburger %}
          <div class="col-12 mb-3 d-flex justify-content-start">
            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#leftMenu" aria-controls="leftMenu">
              â˜° Menu
            </button>
          </div>

          <div class="offcanvas offcanvas-start" tabindex="-1" id="leftMenu" aria-labelledby="leftMenuLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="leftMenuLabel">{% if is_expenses %}Bills &amp; Payments{% else %}Navigation{% endif %}</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              {% if is_expenses and expenses_menu_mode != 'payroll' %}
                <div class="mb-3">
                  <div class="fw-semibold mb-2">Expenses</div>
                  <ul class="mb-0" style="padding-left:1.1rem;">
                    <li><a href="/" style="color:#000; text-decoration:none;">Home</a></li>
                    <li><a href="/expenses" style="color:#000; text-decoration:none;">Expenses</a></li>
                    <li><a href="/subcontracts/new" style="color:#000; text-decoration:none;">Suppliers</a></li>
                    <li><a href="/subcontracts/bills" style="color:#000; text-decoration:none;">Bills &amp; Payments</a></li>
                    <li><a href="/subcontracts/bills?run=1" style="color:#000; text-decoration:none;">Edit Bills</a></li>
                    <li><a href="/subcontracts/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  </ul>
                </div>
              {% else %}
                <div class="mb-3">
                  <div class="fw-semibold mb-2">Main</div>
                  <ul class="mb-0" style="padding-left:1.1rem;">
                    <li><a href="/" style="color:#000; text-decoration:none;">Home</a></li>
                    <li><a href="/payroll" style="color:#000; text-decoration:none;">Run Payroll</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    {% if role == 'owner' %}
                      <li><a href="/owner/payroll/edit" style="color:#000; text-decoration:none;">Edit Payroll</a></li>
                    {% endif %}
                  </ul>
                </div>
                <div>
                  <div class="fw-semibold mb-2">Reports</div>
                  <ul class="mb-0" style="padding-left:1.1rem;">
                    {% if role == 'admin' %}
                      <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                    {% elif role == 'owner' %}
                      <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                      <li><a href="/owner/payroll-summary" style="color:#000; text-decoration:none;">Payroll Summary</a></li>
                    {% endif %}
                  </ul>
                </div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% if not hide_sidebar and not show_hamburger %}
          <div class="col-12 col-md-3 mb-3">
            <div style="background:#C3C3C3; border-left:4px solid #B0151A; border-radius:6px; padding:.7rem; font-size:0.9rem;">
              <div style="color:#B0151A; font-weight:600; margin-bottom:.4rem; font-size:0.9rem;">Navigation</div>
              {% if is_expenses and not is_payroll %}
                <div style="color:#B0151A; font-weight:600; margin-bottom:.5rem;">Navigation</div>
                <ul class="mb-0" style="padding-left:1.1rem;">
                  <li><a href="/" style="color:#000; text-decoration:none;">Home</a></li>
                  <li><a href="/payroll" style="color:#000; text-decoration:none;">Run Payroll</a></li>
                  {% if role == 'admin' %}
                    <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% elif role == 'owner' %}
                    <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% endif %}
                </ul>
              {% elif is_payroll and not is_expenses %}
                <div style="color:#B0151A; font-weight:600; margin-bottom:.5rem;">Run Payroll</div>
                <ul class="mb-0" style="padding-left:1.1rem;">
                  {% if role == 'admin' %}
                    <li><a href="/companies" style="color:#000; text-decoration:none;">Company</a></li>
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/data-entry" style="color:#000; text-decoration:none;">Data Entry</a></li>
                    <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                    <li><a href="/manage/companies" style="color:#000; text-decoration:none;">Edit Company</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/manage/data" style="color:#000; text-decoration:none;">Edit Data</a></li>
                    <li><a href="/admin/submissions" style="color:#000; text-decoration:none;">Submissions</a></li>
                    <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% elif role == 'owner' %}
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/owner/payroll" style="color:#000; text-decoration:none;">Submit Payroll</a></li>
                    <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% else %}
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% endif %}
                </ul>
              {% else %}
                <div style="color:#B0151A; font-weight:600; margin-bottom:.5rem;">Run Payroll</div>
                <ul class="mb-3" style="padding-left:1.1rem;">
                  {% if role == 'admin' %}
                    <li><a href="/companies" style="color:#000; text-decoration:none;">Company</a></li>
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/data-entry" style="color:#000; text-decoration:none;">Data Entry</a></li>
                    <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                    <li><a href="/manage/companies" style="color:#000; text-decoration:none;">Edit Company</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/manage/data" style="color:#000; text-decoration:none;">Edit Data</a></li>
                    <li><a href="/admin/submissions" style="color:#000; text-decoration:none;">Submissions</a></li>
                    <li><a href="/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% elif role == 'owner' %}
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/owner/payroll" style="color:#000; text-decoration:none;">Submit Payroll</a></li>
                    <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% else %}
                    <li><a href="/employees" style="color:#000; text-decoration:none;">Employee</a></li>
                    <li><a href="/manage/employees" style="color:#000; text-decoration:none;">Edit Employee</a></li>
                    <li><a href="/owner/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                  {% endif %}
                </ul>

                <div style="color:#B0151A; font-weight:600; margin-bottom:.5rem;">Sub-Contractor</div>
                <ul class="mb-0" style="padding-left:1.1rem;">
                  <li><a href="/subcontracts/new" style="color:#000; text-decoration:none;">New Supplier</a></li>
                  <li><a href="/subcontracts/bills" style="color:#000; text-decoration:none;">Pay Bills</a></li>
                  <li><a href="/subcontracts/reports" style="color:#000; text-decoration:none;">Reports</a></li>
                </ul>
              {% endif %}
            </div>
          </div>
        {% endif %}

        <div class="col-12 {{ 'col-md-12' if hide_sidebar else 'col-md-9' }}">
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' or category == 'danger' else category }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
          {% block content %}{% endblock %}
        </div>
      </div>
    </div>

    {% set hide_footer = hide_footer|default(false) %}
    {% if not hide_footer %}
      <footer style="background:#C3C3C3; color:#222; padding:0.75rem 0; margin-top:1rem; flex-shrink:0; width:100%;">
        <div class="container text-center">
          <div class="d-flex flex-column align-items-center" style="gap:0.25rem;">
            <span style="color:#B0151A;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="#B0151A" viewBox="0 0 16 16" style="vertical-align:middle; margin-right:4px;"><path d="M3.654 1.328a.678.678 0 0 1 .252-.282c.282-.183.65-.16.888.07l2.29 2.197c.329.316.445.819.267 1.24l-.805 1.86a.678.678 0 0 0 .145.73l2.457 2.457a.678.678 0 0 0 .73.145l1.86-.805c.421-.178.924-.062 1.24.267l2.197 2.29c.23.238.253.606.07.888a13.134 13.134 0 0 1-2.01 2.01c-.238.183-.606.16-.888-.07l-2.197-2.29a1.745 1.745 0 0 0-1.24-.267l-1.86.805a.678.678 0 0 1-.73-.145l-2.457-2.457a.678.678 0 0 1-.145-.73l.805-1.86a1.745 1.745 0 0 0-.267-1.24L1.328 3.654a.678.678 0 0 1-.07-.888 13.134 13.134 0 0 1 2.01-2.01z"/></svg>
              <span style="font-size:0.9rem;">+1 (236) 550-5555</span>
            </span>
          </div>
          <div class="mt-2" style="color:#B0151A; font-size:0.9rem;">&copy; 2026 PB Tax Solutions Inc. All rights reserved.</div>
        </div>
      </footer>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
